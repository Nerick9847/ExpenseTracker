@page "/transaction"
@using ExpenseTracker.Services
@inject BalanceState BalanceState
@inject TransactionService TransactionService


<div class="dashboard-header">
    <div class="buttons-container">
        <button class="btn btn-primary" @onclick="OpenAddModal">Add Transaction</button>
        <button class="btn btn-secondary" @onclick="OpenCategoryModal">Add Category</button>
        <button class="btn btn-info" @onclick="ExportTransactions">Export</button>
    </div>
</div>

<div class="filter-container">
    <input type="text" class="form-control" @bind="descriptionFilter" placeholder="Search by Description" />
    <select class="form-control" @bind="selectedType">
        <option value="">Select Type</option>
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
    </select>
    <select class="form-control" @bind="selectedCategory">
        <option value="">Select Category</option>
        @foreach (var category in database.Categories)
        {
            <option value="@category">@category</option>
        }
    </select>
    <div class="date-range">
        <label>Start Date:</label>
        <input type="date" class="form-control" @bind="startDate" />
        <label>End Date:</label>
        <input type="date" class="form-control" @bind="endDate" />
    </div>
    <div class="filter-buttons">
        <button class="btn btn-primary" @onclick="FilterTransactions">Filter</button>
        <button class="btn btn-secondary" @onclick="ClearFilters">Clear Filters</button>
        <button class="btn btn-info" @onclick="ToggleSort">Sort by Amount @(isSortedAscending ? "Ascending" : "Descending")</button>
    </div>
</div>

<table class="transaction-table">
    <thead>
        <tr>
            <th>Description</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Category</th>
            <th>Notes</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var transaction in filteredTransactions)
        {
            <tr>
                <td>@transaction.Description</td>
                <td>@transaction.Date.ToString("yyyy-MM-dd")</td>
                <td>@transaction.Amount.ToString("C")</td>
                <td class="@(transaction.Type == "Income" ? "text-success" : "text-danger")">@transaction.Type</td>
                <td>@(string.IsNullOrEmpty(transaction.Category) ? "Uncategorized" : transaction.Category)</td>
                <td>@transaction.Notes</td>
                <td>
                    <button class="btn btn-warning" @onclick="() => OpenEditModal(transaction)">Edit</button>
                    <button class="btn btn-danger" @onclick="() => DeleteTransaction(transaction)">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>


@if (showTransactionModal)
{
    <div class="modal">
        <div class="modal-content">
            <h2>@modalTitle</h2>
            <div>
                <label>Description:</label>
                <input type="text" class="form-control" @bind="transactionModel.Description" />
            </div>
            <div>
                <label>Date:</label>
                <input type="date" class="form-control" @bind="transactionModel.Date" />
            </div>
            <div>
                <label>Amount:</label>
                <input type="number" class="form-control" @bind="transactionModel.Amount" />
            </div>
            <div>
                <label>Type:</label>
                <select class="form-control" @bind="transactionModel.Type">
                    <option value="Income">Income</option>
                    <option value="Expense">Expense</option>
                    <option value="Debt">Debt</option>
                </select>
            </div>
            <div>
                <label>Category:</label>
                <select class="form-control" @bind="transactionModel.Category">
                    <option value="">Select Category</option>
                    @foreach (var category in database.Categories)
                    {
                        <option value="@category">@category</option>
                    }
                </select>
            </div>
            <div>
                <label>Notes:</label>
                <input type="text" class="form-control" @bind="transactionModel.Notes" />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" @onclick="CloseTransactionModal">Cancel</button>
                <button class="btn btn-primary" @onclick="SaveTransaction">Save</button>
            </div>
        </div>
    </div>
}

@if (showCategoryModal)
{
    <div class="modal">
        <div class="modal-content">
            <h2>Add Category</h2>
            <div>
                <label>Category Name:</label>
                <input type="text" class="form-control" @bind="newCategory" />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" @onclick="CloseCategoryModal">Cancel</button>
                <button class="btn btn-primary" @onclick="AddCategory">Add</button>
            </div>
        </div>
    </div>
}


